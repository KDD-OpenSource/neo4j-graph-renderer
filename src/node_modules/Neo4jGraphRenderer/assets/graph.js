import $ from 'jquery';
import { graphRenderer } from './renderer';
import { neo4jConnection } from './connection';

const createGraph = (urlSource, query) => {
  const d3Graph = graphRenderer();
  const connection = neo4jConnection(urlSource);
  try {
    connection.executeQuery(query, {}, (err,res) => {
      res = res || {};
      const { graph } = res;
      if (graph) {
        let div = $("#graph");
        div.empty();
        d3Graph.render("graph", div, graph);
      } else {
        if (err) {
          window.alert(err.length > 0
            ? `Cypher error:\n${err}`
            : `JS Error:\n${err}`);
        }
      }
    });
  } catch(e) {
    window.alert(`Caught error: ${e}`);
  }
};

export { createGraph };
